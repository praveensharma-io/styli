{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useCallback, useRef } from 'react';\nimport { useParams } from 'react-router-dom';\n\n// API base URL - in production, this would come from environment variables\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3000';\nconst useServerDrivenUI = (pageType, pageId, userContext = {}) => {\n  _s();\n  const [layout, setLayout] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [lastFetched, setLastFetched] = useState(null);\n\n  // Get URL params for product detail pages\n  const params = useParams();\n\n  // Use ref to store userContext to avoid dependency issues\n  const userContextRef = useRef(userContext);\n  userContextRef.current = userContext;\n\n  // Flag to prevent multiple simultaneous calls\n  const isFetchingRef = useRef(false);\n  const fetchLayout = useCallback(async () => {\n    // Prevent multiple simultaneous calls\n    if (isFetchingRef.current) {\n      return;\n    }\n    try {\n      isFetchingRef.current = true;\n      setLoading(true);\n      setError(null);\n\n      // Add productId to context if available\n      const contextWithProductId = {\n        ...userContextRef.current,\n        productId: params.productId || null\n      };\n      const queryParams = new URLSearchParams({\n        ...contextWithProductId,\n        timestamp: Date.now() // Cache busting\n      });\n      const apiUrl = `${API_BASE_URL}/api/layouts/${pageType}/${pageId}?${queryParams}`;\n      const response = await fetch(apiUrl, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        mode: 'cors'\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const data = await response.json();\n      if (data.success) {\n        setLayout(data.layout);\n        setLastFetched(Date.now());\n      } else {\n        setError(data.message || 'Failed to load layout');\n      }\n    } catch (error) {\n      setError(`Failed to load page layout: ${error.message}`);\n    } finally {\n      setLoading(false);\n      isFetchingRef.current = false;\n    }\n  }, [pageType, pageId, params.productId]);\n  const refreshLayout = useCallback(() => {\n    fetchLayout();\n  }, [fetchLayout]);\n  const updateComponentData = useCallback((componentId, newData) => {\n    if (!layout) return;\n    setLayout(prevLayout => ({\n      ...prevLayout,\n      components: prevLayout.components.map(component => component.id === componentId ? {\n        ...component,\n        data: {\n          ...component.data,\n          ...newData\n        }\n      } : component)\n    }));\n  }, [layout]);\n  const getComponentById = useCallback(componentId => {\n    if (!layout) return null;\n    return layout.components.find(component => component.id === componentId);\n  }, [layout]);\n  const getComponentsByType = useCallback(componentType => {\n    if (!layout) return [];\n    return layout.components.filter(component => component.type === componentType);\n  }, [layout]);\n  useEffect(() => {\n    fetchLayout();\n  }, [pageType, pageId, params.productId, fetchLayout]);\n  return {\n    layout,\n    loading,\n    error,\n    lastFetched,\n    refreshLayout,\n    updateComponentData,\n    getComponentById,\n    getComponentsByType\n  };\n};\n_s(useServerDrivenUI, \"bL1YHI2tp2JjXQMKHrMXBLeu4Qk=\", false, function () {\n  return [useParams];\n});\nexport default useServerDrivenUI;","map":{"version":3,"names":["useState","useEffect","useCallback","useRef","useParams","API_BASE_URL","process","env","REACT_APP_API_URL","useServerDrivenUI","pageType","pageId","userContext","_s","layout","setLayout","loading","setLoading","error","setError","lastFetched","setLastFetched","params","userContextRef","current","isFetchingRef","fetchLayout","contextWithProductId","productId","queryParams","URLSearchParams","timestamp","Date","now","apiUrl","response","fetch","method","headers","mode","ok","Error","status","data","json","success","message","refreshLayout","updateComponentData","componentId","newData","prevLayout","components","map","component","id","getComponentById","find","getComponentsByType","componentType","filter","type"],"sources":["/Users/macos/stylii/client/src/hooks/useServerDrivenUI.js"],"sourcesContent":["import { useState, useEffect, useCallback, useRef } from 'react';\nimport { useParams } from 'react-router-dom';\n\n// API base URL - in production, this would come from environment variables\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3000';\n\nconst useServerDrivenUI = (pageType, pageId, userContext = {}) => {\n  const [layout, setLayout] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [lastFetched, setLastFetched] = useState(null);\n  \n  // Get URL params for product detail pages\n  const params = useParams();\n  \n  // Use ref to store userContext to avoid dependency issues\n  const userContextRef = useRef(userContext);\n  userContextRef.current = userContext;\n  \n  // Flag to prevent multiple simultaneous calls\n  const isFetchingRef = useRef(false);\n\n  const fetchLayout = useCallback(async () => {\n    // Prevent multiple simultaneous calls\n    if (isFetchingRef.current) {\n      return;\n    }\n    \n    try {\n      isFetchingRef.current = true;\n      setLoading(true);\n      setError(null);\n\n      // Add productId to context if available\n      const contextWithProductId = {\n        ...userContextRef.current,\n        productId: params.productId || null\n      };\n\n      const queryParams = new URLSearchParams({\n        ...contextWithProductId,\n        timestamp: Date.now() // Cache busting\n      });\n\n      const apiUrl = `${API_BASE_URL}/api/layouts/${pageType}/${pageId}?${queryParams}`;\n\n      const response = await fetch(apiUrl, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        mode: 'cors'\n      });\n      \n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      \n      const data = await response.json();\n\n      if (data.success) {\n        setLayout(data.layout);\n        setLastFetched(Date.now());\n      } else {\n        setError(data.message || 'Failed to load layout');\n      }\n    } catch (error) {\n      setError(`Failed to load page layout: ${error.message}`);\n    } finally {\n      setLoading(false);\n      isFetchingRef.current = false;\n    }\n  }, [pageType, pageId, params.productId]);\n\n  const refreshLayout = useCallback(() => {\n    fetchLayout();\n  }, [fetchLayout]);\n\n  const updateComponentData = useCallback((componentId, newData) => {\n    if (!layout) return;\n\n    setLayout(prevLayout => ({\n      ...prevLayout,\n      components: prevLayout.components.map(component =>\n        component.id === componentId\n          ? { ...component, data: { ...component.data, ...newData } }\n          : component\n      )\n    }));\n  }, [layout]);\n\n  const getComponentById = useCallback((componentId) => {\n    if (!layout) return null;\n    return layout.components.find(component => component.id === componentId);\n  }, [layout]);\n\n  const getComponentsByType = useCallback((componentType) => {\n    if (!layout) return [];\n    return layout.components.filter(component => component.type === componentType);\n  }, [layout]);\n\n  useEffect(() => {\n    fetchLayout();\n  }, [pageType, pageId, params.productId, fetchLayout]);\n\n  return {\n    layout,\n    loading,\n    error,\n    lastFetched,\n    refreshLayout,\n    updateComponentData,\n    getComponentById,\n    getComponentsByType\n  };\n};\n\nexport default useServerDrivenUI; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}