{"ast":null,"code":"import{useState,useEffect,useCallback,useRef}from'react';// API base URL - in production, this would come from environment variables\nconst API_BASE_URL=process.env.REACT_APP_API_URL||'http://localhost:3000';const useServerDrivenUI=function(pageType,pageId){let userContext=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};const[layout,setLayout]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[lastFetched,setLastFetched]=useState(null);// Use ref to store userContext to avoid dependency issues\nconst userContextRef=useRef(userContext);userContextRef.current=userContext;// Flag to prevent multiple simultaneous calls\nconst isFetchingRef=useRef(false);const fetchLayout=useCallback(async()=>{// Prevent multiple simultaneous calls\nif(isFetchingRef.current){return;}try{isFetchingRef.current=true;setLoading(true);setError(null);const queryParams=new URLSearchParams({...userContextRef.current,timestamp:Date.now()// Cache busting\n});const apiUrl=`${API_BASE_URL}/api/layouts/${pageType}/${pageId}?${queryParams}`;const response=await fetch(apiUrl,{method:'GET',headers:{'Content-Type':'application/json'},mode:'cors'});if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`);}const data=await response.json();if(data.success){setLayout(data.layout);setLastFetched(Date.now());}else{setError(data.message||'Failed to load layout');}}catch(error){setError(`Failed to load page layout: ${error.message}`);}finally{setLoading(false);isFetchingRef.current=false;}},[pageType,pageId]);const refreshLayout=useCallback(()=>{fetchLayout();},[fetchLayout]);const updateComponentData=useCallback((componentId,newData)=>{if(!layout)return;setLayout(prevLayout=>({...prevLayout,components:prevLayout.components.map(component=>component.id===componentId?{...component,data:{...component.data,...newData}}:component)}));},[layout]);const getComponentById=useCallback(componentId=>{if(!layout)return null;return layout.components.find(component=>component.id===componentId);},[layout]);const getComponentsByType=useCallback(componentType=>{if(!layout)return[];return layout.components.filter(component=>component.type===componentType);},[layout]);useEffect(()=>{fetchLayout();},[pageType,pageId,fetchLayout]);return{layout,loading,error,lastFetched,refreshLayout,updateComponentData,getComponentById,getComponentsByType};};export default useServerDrivenUI;","map":{"version":3,"names":["useState","useEffect","useCallback","useRef","API_BASE_URL","process","env","REACT_APP_API_URL","useServerDrivenUI","pageType","pageId","userContext","arguments","length","undefined","layout","setLayout","loading","setLoading","error","setError","lastFetched","setLastFetched","userContextRef","current","isFetchingRef","fetchLayout","queryParams","URLSearchParams","timestamp","Date","now","apiUrl","response","fetch","method","headers","mode","ok","Error","status","data","json","success","message","refreshLayout","updateComponentData","componentId","newData","prevLayout","components","map","component","id","getComponentById","find","getComponentsByType","componentType","filter","type"],"sources":["/Users/macos/stylii/client/src/hooks/useServerDrivenUI.js"],"sourcesContent":["import { useState, useEffect, useCallback, useRef } from 'react';\n\n// API base URL - in production, this would come from environment variables\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3000';\n\nconst useServerDrivenUI = (pageType, pageId, userContext = {}) => {\n  const [layout, setLayout] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [lastFetched, setLastFetched] = useState(null);\n  \n  // Use ref to store userContext to avoid dependency issues\n  const userContextRef = useRef(userContext);\n  userContextRef.current = userContext;\n  \n  // Flag to prevent multiple simultaneous calls\n  const isFetchingRef = useRef(false);\n\n  const fetchLayout = useCallback(async () => {\n    // Prevent multiple simultaneous calls\n    if (isFetchingRef.current) {\n      return;\n    }\n    \n    try {\n      isFetchingRef.current = true;\n      setLoading(true);\n      setError(null);\n\n      const queryParams = new URLSearchParams({\n        ...userContextRef.current,\n        timestamp: Date.now() // Cache busting\n      });\n\n      const apiUrl = `${API_BASE_URL}/api/layouts/${pageType}/${pageId}?${queryParams}`;\n\n      const response = await fetch(apiUrl, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        mode: 'cors'\n      });\n      \n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      \n      const data = await response.json();\n\n      if (data.success) {\n        setLayout(data.layout);\n        setLastFetched(Date.now());\n      } else {\n        setError(data.message || 'Failed to load layout');\n      }\n    } catch (error) {\n      setError(`Failed to load page layout: ${error.message}`);\n    } finally {\n      setLoading(false);\n      isFetchingRef.current = false;\n    }\n  }, [pageType, pageId]);\n\n  const refreshLayout = useCallback(() => {\n    fetchLayout();\n  }, [fetchLayout]);\n\n  const updateComponentData = useCallback((componentId, newData) => {\n    if (!layout) return;\n\n    setLayout(prevLayout => ({\n      ...prevLayout,\n      components: prevLayout.components.map(component =>\n        component.id === componentId\n          ? { ...component, data: { ...component.data, ...newData } }\n          : component\n      )\n    }));\n  }, [layout]);\n\n  const getComponentById = useCallback((componentId) => {\n    if (!layout) return null;\n    return layout.components.find(component => component.id === componentId);\n  }, [layout]);\n\n  const getComponentsByType = useCallback((componentType) => {\n    if (!layout) return [];\n    return layout.components.filter(component => component.type === componentType);\n  }, [layout]);\n\n  useEffect(() => {\n    fetchLayout();\n  }, [pageType, pageId, fetchLayout]);\n\n  return {\n    layout,\n    loading,\n    error,\n    lastFetched,\n    refreshLayout,\n    updateComponentData,\n    getComponentById,\n    getComponentsByType\n  };\n};\n\nexport default useServerDrivenUI; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}